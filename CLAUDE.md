# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Personal blog/website built with 11ty (Eleventy) v3 static site generator using ESM modules throughout. The site focuses on web development content, particularly web components and modern web APIs. Interactive code examples are powered by custom web components.

## 11ty References

- Fetch this link for reference when you need to look up how 11ty works: https://context7.com/11ty/11ty-website/llms.txt?tokens=10000

## Development Commands

- `pnpm start` - Start development server with live reload (localhost:8080)
- `pnpm build` - Build static site for production (outputs to `_site/`)
- No test suite exists in this project

## Build & Deployment

- **Build tool**: 11ty v3 with ESM configuration (`.eleventy.js`)
- **Input**: `src/` â†’ **Output**: `_site/`
- **Deployed on Netlify** (`netlify.toml`): production build uses `pnpm dlx @11ty/eleventy`
- **Netlify functions**: `netlify/functions/` (currently has `reading-list.mjs`)
- Passthrough copy handles all static assets (CSS, JS, images, fonts, videos, webmanifest)

## Architecture

### Templates & Layouts

- **Nunjucks + Markdown**: Pages use `.njk` and `.md` files in `src/`
- **Main layout**: `src/_includes/index.njk` â€” HTML shell with preloads, SEO shortcode, nav, footer
- **Post layout**: `src/_includes/post.njk` â€” wraps `index.njk`, adds article wrapper + prev/next nav
- **Partials**: `src/_includes/` contains `nav.njk`, `footer.njk`, `next-previous.njk`, `contact.njk`, `socials.njk`, `written-by-human.njk`, `quick-search.njk`

### Page Titles

Generated by `eleventy-plugin-seo` via `{% seo "" %}` in `index.njk`. Uses frontmatter `title` field, appending ` - Jschof.dev` as suffix. Pages without `title` default to `Jschof.dev`.

### 11ty Shortcodes (defined in `.eleventy.js`)

- `prettyDate(date, format)` â€” Formats dates with date-fns (fixes UTC offset)
- `socials()` â€” Returns social links HTML
- `joinPaths(...paths)` â€” Joins paths using node:path
- `readTime(page)` â€” Calculates approximate reading time in minutes

### Blog Posts

- Located in `src/posts/` organized by `year/month/post-slug/index.md`
- Frontmatter: `title`, `excerpt`, `layout: post`, `tags: [posts, ...]`, `image`, `date`
- Post listing page: `src/posts/index.md`

### Web Components

Custom web components live in `component/` as **separate Vite + TypeScript + Lit projects**. Each has its own `package.json`, build system, and dependencies.

| Component | Directory | Purpose |
|---|---|---|
| `play-ground` | `component/play-ground/` | Interactive code editor/playground (CodeMirror) |
| `code-highlight` | `component/code-highlight/` | Syntax highlighting component |
| `quick-search` | `component/quick-search/` | Site-wide search |
| `reading-list` | `component/reading-list/` | Reading list from Google Sheets API |
| `repl-playground` | `component/repl-playground/` | REPL-based playground |
| `terminal-playground` | `component/terminal-playground/` | Terminal emulator |

**Build & integration pattern**: Each component builds with `tsc && vite build` into its own `dist/` directory. The built output is **symlinked** into `src/js/` (e.g., `src/js/play-ground.js` â†’ `../../component/play-ground/dist/assets/index.js`). All components are imported in `src/index.js`.

To rebuild a component after changes:
```bash
cd component/<name> && pnpm build
```

### JavaScript Entry Point

`src/index.js` imports all web components and initializes the mobile menu:
- Web component imports (symlinks to `component/*/dist/`)
- `src/js/heading-links.js` â€” clipboard copy for heading links
- `src/js/mobile-menu.js` â€” hamburger menu class
- `src/js/baseline-status.min.js` â€” copied from `node_modules` via passthrough

### Data Files

- `src/_data/api.js` â€” Exposes Google Sheets API credentials from environment variables
- Environment variables needed: `GOOGLE_SHEETS_API_KEY`, `GOOGLE_SHEETS_READING_ID` (and related Google auth vars in `.env`)

### Custom 11ty Plugins

**Syntax Highlighting** (`eleventy/highlight.js`): Shiki with Tokyo Night theme.

**Auto-Heading IDs** (`plugins/auto-heading-ids.js`):
- Generates IDs for h2-h6 headings in posts only (files under `/posts/`)
- Adds paperclip (ðŸ“Ž) links for sharing heading URLs
- Uses Happy DOM for HTML parsing
- Skips headings inside web components
- CSS class: `.heading-link` (hidden by default, visible on heading hover)

## Performance Patterns

When adding new resources or features, maintain these existing patterns:
- **Preloading**: Critical CSS, fonts, and JS are preloaded in `index.njk`
- **Font display**: `font-display: swap` on custom fonts (Atkinson Hyperlegible)
- **Lazy loading**: All post images use `loading="lazy"`; homepage profile uses `fetchpriority="high"`
- **View transitions**: CSS `view-transition: auto` is enabled

## CSS

Single stylesheet at `src/css/main.css`. Uses CSS custom properties for the color palette (e.g., `--paynes-gray`, `--seasalt`, `--carrot`, `--teal`). Font stack: Atkinson Hyperlegible Next (variable font in `src/assets/fonts/`) with Fira Code from Google Fonts for code blocks.
