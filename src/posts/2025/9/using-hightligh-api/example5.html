<play-ground>
  <template>
    <style>
      ::highlight(my-highlight) {
        background: cyan;
      }
    </style>
    <label for="search">
      Search the text for:
      <input type="text" id="search" placeholder="Search string" />
    </label>
    <blockquote>
      <p>
        Cats are intriguing animals that make excellent pets. Their
        independence, grace, and intelligence allow them to adapt to any living
        situation. Furthermore, their ability to maintain themselves and hunt
        makes them low-maintenance and practical companions. Unlike dogs, who
        sometimes want continual attention and care from their owners, cats are
        satisfied to do their own thing and enjoy the company of their own. They
        have an inherent feeling of independence that distinguishes them from
        other tamed animals. Furthermore, their slim and nimble bodies move with
        elegance and beauty that no other animal can match. They are natural
        born athletes, and it is a thrill to watch them leap, pounce, and play.
      </p>
      <cite
        ><a
          href="https://www.reddit.com/r/AwardBonanza/comments/12lv9hd/comment/jg84gwe/"
          >Some reddit user</a
        ></cite
      >
    </blockquote>
    <script type="module">
      const highlight = new Highlight();
      CSS.highlights.set("my-highlight", highlight);

      const pTag = document.querySelector("p");
      const aTag = document.querySelector("a");

      function findMatches(node, str) {
        const regex = new RegExp(str, "igd");
        const matches = Array.from(node.textContent.matchAll(regex));

        return matches.map(({ indices }) => indices[0]);
      }

      function highlightRanges(node, rangesArray) {
        for (const [start, end] of rangesArray) {
          const range = new Range();
          range.setStart(node.firstChild, start);
          range.setEnd(node.firstChild, end);

          highlight.add(range);
        }
      }

      document.getElementById("search").addEventListener("input", (event) => {
        highlight.clear();

        const results = findMatches(pTag, event.target.value);
        highlightRanges(pTag, results);

        const results2 = findMatches(aTag, event.target.value);
        highlightRanges(aTag, results2);
      });
    </script>
  </template>
</play-ground>
